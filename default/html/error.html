@template spaark
@title Error

<?
$trace    = $error->getTrace();
$spaark   = array_pop($trace);
$first    = true;
$split    = strrpos(get_class($error), '\\') + 1;
$skipping = false;
?>

<?=substr(get_class($error), 0, $split)?>
<h2 style="margin-top: 0;"><?=substr(get_class($error), $split)?></h2>

<b><?=nl2br($error->getMessage())?></b><br />
<?=$error->getFile()?>:<?=$error->getLine()?>

<br />

<h2>Stack Trace</h2>

<?foreach ($trace as $i => $step) : extract($step)?>
  <!--?if ($skipping)
    {
        if
        (
            isset($trace[$i + 1])          &&
            isset($trace[$i + 1]['class']) &&
            strpos($trace[$i + 1]['class'], 'Spaark') !== 0
        )
        {
            $skipping = false;
        }
        else
        {
            continue;
        }
    }
    elseif
    (
        isset($step['class']) &&
        strpos($step['class'], 'Spaark') === 0
    )
    {
        $skipping = true;
    }
  ?-->
        
  <? if (!$first) : ?>
    <hr style="margin-bottom: 10px;" />
  <? else : $first = false; ?>
  <? endif ?>
  
  <? if (true || $function != 'invokeArgs') : ?>
    
    <? if (isset($step['class'])) : ?>
      {class} ->
    <? endif ?>
    
    {function}
    (
      <? if (isset($step['args'])) : ?>
        <? foreach ($step['args'] as $arg) : ?>
          <? if (is_object($arg)) : ?>
            <?=get_class($arg)?>,
          <? elseif (is_array($arg)) : ?>
            <span style="color: red;">array(<?=count($arg)?>)</span>,
          <? elseif (is_string($arg)) : ?>
            <span style="color: green">"{arg}"</span>,
          <? elseif ($arg === NULL) : ?>
            <b>NULL</b>,
          <? else : ?>
            {arg},
          <? endif ?> 
        <? endforeach ?>
      <? endif ?>
    )
    <br />
  <? endif ?>
  
  <? if (isset($step['file'])) : ?>
    {file}:{line}
  <? endif ?>
<? endforeach ?>

<hr style="margin-bottom: 10px;" />

<b>\{Spaark}</b>
<br />
<?=$spaark['file']?>:<?=$spaark['line']?>